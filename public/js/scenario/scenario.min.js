var debug_flag=true;var default_background="/images/stickers/0-backgrounds/ASproul.jpg";$(document).ready(function(){$("#selfie").attr("src","../users/"+getCookie("pyuserid")+"/1_sticker.png");$("#toolicon li").on("click",function(){$(this).parent().children().removeClass("active");$(this).addClass("active")});$(".kineticjs-content").css("position","");$("#modal").hide();$("#color_change_canvas").hide()});app.controller("ScenarioCtrl",function(k,l,i,e,j){var b=800;var a=550;k.loading=false;k.chroma_green=false;k.image_sources={};k.selected_image=null;kinetic=kineticSetup(b,a);var g=kinetic.layer;var h=kinetic.stage;var f=h.container();var c=null;$('select[name="colorpicker"]').simplecolorpicker({picker:true}).on("change",function(){change_color($('select[name="colorpicker"]').val(),g,k)});var d=function(){var m=$(h.find(".y, .x, .delete, .rotate, .background"));m.each(function(n){m[n].visible(false)});$("#modal").hide();g.draw()};k.background=backgroundSetup(d,default_background,g,h);k.background_update=function(m){k.background.getImage().src=m.target.src};grabBackgroundImages(k,i,e);grabStickerImages(k,i,e);k.addDrag=function(){$(".sticker").bind("dragstart",function(m){k.dragged_image=this;if($(this).data("chroma_green")==true){k.chroma_green=true}else{k.chroma_green=false}})};f.addEventListener("drop",function(q){q.preventDefault();if(k.selected_sticker!=null){k.selected_sticker.toggleTools(false)}var m=k.chroma_green;imageObj=new Image();imageObj.src=k.dragged_image.src;var r=null;if(m){var o=k.image_sources[k.dragged_image.name];r=new Image();r.src=o.back;imageObj.src=o.fore;k.selected_background=r}x=q.pageX-$("#container").offset().left;y=q.pageY-$("#container").offset().top;var n={width:120,height:120};var p=j.newSticker(imageObj,{x:x,y:y},n,g,r,k,h);k.selected_sticker=p;p.image.on("click",function(t){var s=p.scalerX.visible();if(s){k.selected_background=null;k.selected_sticker=null}else{if(k.selected_sticker!=null){k.selected_sticker.toggleTools(false)}k.selected_sticker=p;if(k.selected_sticker.previous_color!=null){$('select[name="colorpicker"]').simplecolorpicker("selectColor",k.selected_sticker.previous_color)}if(m){p.move_color();k.selected_background=r}}p.toggleTools(!s);g.draw()})});k.call_email=function(){$(".loader").show();d();h.draw();var m=prompt("Please enter your friend's email(s)","oski@berkeley.edu, friend@berkeley.edu");if(m!==null){m=m.replace(/\s+/g,"");pyuserid=getCookie("pyuserid");h.toDataURL({callback:function(n){debug("callback");email(pyuserid,m,n)}})}else{$(".loader").hide()}};f.addEventListener("dragover",function(m){m.preventDefault()})}).directive("addDrag",function(){return function(a,c,b){a.$eval("addDrag()")}});function debug(a){if(debug_flag){console.log(a)}};