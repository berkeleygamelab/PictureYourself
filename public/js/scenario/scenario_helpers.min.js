function kineticSetup(d,c){var a=new Kinetic.Stage({container:"container",width:d,height:c});var b=new Kinetic.Layer();a.add(b);return{stage:a,layer:b}}function backgroundSetup(e,d,c,a){var f=new Image();var b=new Kinetic.Image({image:f,x:0,y:0,width:a.getWidth(),height:a.getHeight()});f.src=default_background;f.onload=function(){c.add(b);b.setZIndex(0);c.draw()};b.on("click",function(){e()});return b}function change_color(e,j,p){if(p.selected_sticker){p.selected_sticker.previous_color=e}var c=document.getElementById("color_change_canvas");var b=c.getContext("2d");c.width=p.selected_background.width;c.height=p.selected_background.height;b.clearRect(0,0,c.width,c.height);b.drawImage(p.selected_background,0,0,c.width,c.height);var o=0;var m=0;var l=p.selected_background.width;var h=p.selected_background.height;var a=b.getImageData(o,m,l,h);var g=a.data;var k=hexToRgb(e);for(var f=0,d=g.length;f<d;f+=4){g[f]=k.r;g[f+1]=k.g;g[f+2]=k.b}b.putImageData(a,0,0);p.selected_background.onload=null;p.selected_background.src=c.toDataURL("image/png");j.draw()}function grabBackgroundImages(a,c,b){c.get("/stickers/backgrounds").success(function(d){a.background_images=d})}function grabStickerImages(b,d,c){var a="shoes_and_pants";d.get("/stickers").success(function(e){e=angular.fromJson(e);b.visible={};b.stickers=e.stickers;b.categories=e.categories;b.sticker_keys=Object.keys(b.categories);angular.forEach(b.stickers,function(g,f){b.visible[f]=(f==a);angular.forEach(g,function(h){if(h.chroma_green){b.image_sources[h.name]={fore:h.fore_source,back:h.back_source}}})})})}function hexToRgb(b){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};