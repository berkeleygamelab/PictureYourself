var debug_flag=false;var default_background="/images/stickers/0-backgrounds/Asproul.png";$(document).ready(function(){$("#modal").hide();$("#toolicon li").on("click",function(){$(this).parent().children().removeClass("active");$(this).addClass("active")});$(".kineticjs-content").css("position","")});function ChromaCtrl(i){var c=800;var b=550;i.selected_image=null;var f=new Kinetic.Stage({container:"container",width:c,height:b});var d=new Kinetic.Layer();f.add(d);var e=new Kinetic.Rect({width:c,height:b,opacity:0});e.on("click",function(){i.selected_image=null;$("#modal").hide()});d.add(e);var g=new Kinetic.Group({draggable:true});d.add(g);var a=new Kinetic.Group({draggable:true});d.add(a);foregroundImg=new Image();foregroundImg.src="/images/stickers/2-shirts/zSweaterWomanPink.png";backgroundImg=new Image();backgroundImg.src="/images/stickers/2-shirts/zSweaterWomanPink_back.png";f2=new Image();f2.src="images/stickers/2-shirts/zSweaterGuyBlue.png";f2b=new Image();f2b.src="images/stickers/2-shirts/zSweaterGuyBlue_back.png";foregroundImg.onload=function(){var j=new Kinetic.Image({image:foregroundImg,width:120,height:120,x:c/2-60,y:b/2-60});g.add(j);d.draw()};backgroundImg.onload=function(){var j=new Kinetic.Image({image:backgroundImg,width:120,height:120,x:c/2-60,y:b/2-60});if(i.selected_image==null){i.selected_image=backgroundImg}g.add(j);d.draw()};function h(k,l){var j=document.getElementById("container");$("#modal").css({left:l.pageX,top:l.pageY});$("#modal").show();console.log($("#modal").offset())}g.on("click",function(j){if(i.selected_image==backgroundImg){$("#modal").hide();i.selected_image=null}else{i.selected_image=backgroundImg;h(this,j)}});g.on("dragmove",function(j){$("#modal").offset({left:j.pageX,top:j.pageY})});f2.onload=function(){var j=new Kinetic.Image({image:f2,width:120,height:120,x:c/2-60,y:b/2-60});a.add(j);d.draw()};f2b.onload=function(){var j=new Kinetic.Image({image:f2b,width:120,height:120,x:c/2-60,y:b/2-60});a.add(j);d.draw()};a.on("click",function(j){if(i.selected_image==f2b){$("#modal").hide();i.selected_image=null}else{i.selected_image=f2b;h(this,j)}});a.on("dragmove",function(j){$("#modal").offset({left:j.pageX-this.getChildren()[0].getWidth()/2,top:j.pageY-this.getChildren()[0].getHeight()})});i.change_color=function(o){var l=document.getElementById("color_change_canvas");var k=l.getContext("2d");k.clearRect(0,0,l.width,l.height);k.drawImage(i.selected_image,0,0,120,120);var v=0;var u=0;var t=i.selected_image.width;var r=i.selected_image.height;var j=k.getImageData(v,u,t,r);var q=j.data;var s=hexToRgb(o);for(var p=0,m=q.length;p<m;p+=4){q[p]=s.r;q[p+1]=s.g;q[p+2]=s.b}k.putImageData(j,0,0);i.selected_image.src=l.toDataURL("image/png");d.draw()};jQuery(document).ready(function(j){j("#color1").colorPicker({onColorChange:function(l,k){i.change_color(k)}})})}function hexToRgb(b){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}ChromaCtrl["$inject"]=["$scope"];