app.factory("Sticker",function(){return{newSticker:function(b,h,d,g,a){var f={background:null,delete_icon:null,group:null,image:null,imageBack:null,move_color:null,previous_color:null,rotate:null,scalerX:null,scalerY:null,reposition:null};var c=0;var e=30;f.group=new Kinetic.Group({draggable:true,x:h.x+d.width/2,y:h.y+d.height/2});f.image=new Kinetic.Image({image:b,width:d.width,height:d.height,x:0,y:0,offsetX:d.width/2,offsetY:d.height/2,});if(a!=null){f.imageBack=new Kinetic.Image({image:a,width:d.width,height:d.height,offsetX:d.width/2,offsetY:d.height/2,x:0,y:0,})}f.background=new Kinetic.Rect({width:d.width,height:d.height,x:0,y:0,offsetX:d.width/2,offsetY:d.height/2,fill:"#00cdcd",visible:true,opacity:0.2,name:"background"});f.delete_icon=new Kinetic.Text({visible:true,text:"",fontFamily:"FontAwesome",fontSize:e,fill:"#eee",stroke:"#222",strokeWidth:0.75,name:"delete",x:d.width/2,y:-d.height/2,offsetX:e/2,offsetY:e/2});f.scalerX=new Kinetic.Text({x:d.width/2,y:d.height/2,offsetX:e/2,offsetY:e/2,text:"",fontFamily:"FontAwesome",fontSize:e,fill:"#eee",stroke:"#222",strokeWidth:0.75,draggable:true,visible:true,name:"x",});f.scalerY=new Kinetic.Text({x:-d.width/2,y:-d.height/2,offsetY:e/2,offsetX:e*13/60,text:"",fontFamily:"FontAwesome",fontSize:e,fill:"#eee",stroke:"#222",strokeWidth:0.75,draggable:true,visible:true,name:"y",});f.rotate=new Kinetic.Text({x:-d.width/2,y:d.height/2,offsetX:e/2,offsetY:e/2,text:"",fontFamily:"FontAwesome",fontSize:e,fill:"#eee",stroke:"#222",strokeWidth:0.75,draggable:true,visible:true,name:"rotate",});if(a!=null){f.imageBack.offsetX(d.width/2);f.imageBack.offsetY(d.height/2)}if(a!=null){a.onload=function(){if(c>0){return i()}c++};b.onload=function(){if(c>0){return i()}c++}}else{b.onload=function(){return i()}}var i=function(){if(a!=null){f.group.add(f.imageBack)}f.group.add(f.background);f.group.add(f.image);f.group.add(f.scalerX);f.group.add(f.scalerY);f.group.add(f.delete_icon);f.group.add(f.rotate);g.add(f.group);f.reposition();if(a!=null){f.move_color()}g.draw()};f.reposition=function(){var j=f.image.width()/2;var m=f.image.height()/2;var l=$(".kineticjs-content").position().left;var k=$(".kineticjs-content").position().top;f.rotate.x(-j);f.rotate.y(m);f.scalerX.x(-j);f.scalerX.y(-m);f.scalerY.x(j);f.scalerY.y(m);f.delete_icon.x(j);f.delete_icon.y(-m);f.background.x(0);f.background.y(0);f.background.width(j*2);f.background.height(m*2);f.background.offsetX(j);f.background.offsetY(m)};f.move_color=function(){$("#modal").css({left:$(".kineticjs-content").position().left+(f.rotate.getAbsolutePosition().x+f.scalerY.getAbsolutePosition().x)/2-e/2,top:$(".kineticjs-content").position().top+(f.rotate.getAbsolutePosition().y+f.scalerY.getAbsolutePosition().y)/2-e/2});$("#modal").show()};return f}}});